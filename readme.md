

# 基于DWG的CAD工程图纸分工与进度计划


# 一、项目目标与范围

* **目标**：在DWG楼层图中，对“灯具/开关/插座”三大类对象进行检测与计数，输出类型、概率、位置，并支持前端自动切块、虚拟尺寸映射与可视化标注。
* **对象定义**

	* 简单类：轴对称、几何特征强的符号（如标准开关、圆形筒灯、规则插座符号）。
	* 复杂类：相似度极高、彼此细微差异的符号（如多连体/多位/特殊图框的灯具/插座/开关组合）。

* **数据规模**：

	训练/验证用截图：**简单类≥300/类**，**复杂类≥500/类**；单独准备**验证集100张**。


# 二、组织与分工（RACI）


| 角色           | 人员   | 职责                          |
|-  |- | - |
| 项目经理/需求方（PM） | 1人   | 范围/里程碑/资源协调、验收把关            |
| CAD工程师（CAD）  | 1–2人 | DWG清理/统一图层、定位含目标对象的帧、自动截屏脚本 |
| 数据工程师（DE）    | 1人 | 数据清洗/标注转换/预处理、数据集版本管理       |
| 算法工程师（Algo）  | 1人   | 类别体系设计、模型训练/调参/评估、误检漏检分析    |
| 标注组（Label）   | 2–4人 | 规范制定、标注与质检                  |
| 后端工程师（BE）    | 1人 | 模型封装推理服务、接口、部署与扩缩容          |
| 前端工程师（FE）    | 1人 | DWG切块、虚拟尺寸映射、结果可视化、交互       |
| 测试/QA        | 1人   | 用例设计、回归测试、指标复核              |




# 三、WBS

1. **类别体系设计与采样（优先级Top50）**

	* 基于相似度、轴对称、几何特征分组 → 标注“简单类/复杂类”清单
	* 产出：类别字典、示例图库、命名规范

2. **样本选取（简单×5、复杂×5）**: 各取5个代表性对象，确认符号变体/旋转/比例/图层差异
3. **DWG整理与截图集构建**
	* 批量筛选含目标对象的DWG → 定位楼层画面 → 稳定视口与比例 → 自动截屏
	* 数量达标：简单≥300/类、复杂≥500/类；另截100张独立验证图
4. **标注与质检**
	* 统一标注格式（YOLO），双人复核；输出版本号与类映射
5. **数据预处理**
	* 去重/归一化/难例挑选/数据划分（train/val/test）；生成数据卡（Data Card）
6. **模型训练与选择**
	* 基线模型→调参（多尺度、旋转增强）→蒸馏/先验融合（几何约束）→选最优权重
7. **验证与统计**
	* 在100张验证图计算**漏检率（FN/(TP+FN)）**、**误检率（FP/(TP+FP)）**、mAP、FPS
8. **后端服务**
	* 推理接口：识别对象类型、概率、位置；批量/流式；可配置阈值与NMS
9. **前端工程**
	* DWG切块定位→虚拟尺寸映射→生成图片→调用后端→结果叠加渲染与导出


# 四、时间表与里程碑（8周，2025-10-20 ～ 2026-2-15）


* **W1（10/20–10/26）**
	* 选定**简单类5个、复杂类5个**；样例库收集
	* 大规模截图采集（统一比例、命名规则、达成简单≥300/类、复杂≥500/类目标的70%、验证集100张）
	* 建立截图数据版本库（DVC/Git-LFS），开启标注流程
	* 前端：DWG切块与虚拟尺寸映射、调用后端、叠加可视化
	
* **W2（10/27–11/02）**
	* 标注与质检（第一轮）；
	* 预处理（归一化、数据划分）生成训练数据集v1.0（train/val/test）
	* 模型基线训练与评估；难例挖掘；几何先验/旋转增强注入
	* 产出：Baseline权重v1、评估报告v1
  
* **W3（11/03–11/09）**
	* 改进训练（架构/超参/蒸馏）；ONNX导出与推理优化
	* 后端接口原型（FastAPI）生成
	* 后端接入FastAPI，前后联调与优化
	* 产出：最优权重候选、后端v0.9
  
  
* **W4（11/10–11/16）**
	* 验证集100张测评：漏检/误检/速度；回归与修复
	* 修正截图和标注的精度
  
* **W5（11/17–11/30）**
	* 选定 10个类，迭代流程 W1-W4流程
  
* **W6（12/1–12/14）**
	* 选定 10个类，迭代流程 W1-W4流程
  
* **W7（12/15–12/28）**
	* 选定 10个类，迭代流程 W1-W4流程
  
* **W8（12/29–1/11）**
	* 选定 10个类，迭代流程 W1-W4流程
  

**里程碑与验收标准**

1. M1 (技术验证)[11/09]：核心是“跑通”，确保数据、算法、前端、后端四大环节能够顺畅协作，形成最小可行产品（MVP）。
2. M2 (质量打磨)[11/16]：核心是“做精”，对首批核心类别进行深度优化和严格验收，确保单点质量过硬，为大规模复制树立标杆。
3. M3 (规模验证)[12/14]：核心是“复制”，验证团队能否将已验证的流程高效、高质量地复制到更多类别上，标志着项目的主要风险已消除。
4. M4 (全面交付)[01/11]：核心是“完工”，完成所有开发任务，确保整个系统达到可交付、可上线的成熟度。


# 五、数据与标注规范

* **截图命名**：`{fileID}_{floorId}_{id}.png`；保持比例/分辨率一致
* **标注格式**：YOLO
* **质检**：双人复核+冲突仲裁；抽检≥10%，问题回流再标


# 六、模型方案

* **检测器**：RT-DETR或YOLOv8/10（支持旋转/小目标、轻量高效）
* **增强**：旋转、尺度随机、对比度/噪声轻扰动、模板先验融合（复杂类）
* **损失与阈值**：分类/定位联合优化，NMS与置信度阈值分对象可配
* **指标**：**漏检率、误检率**



# 七、后端接口草案（FastAPI）

**POST** `/api/v1/detect`

* **请求**（multipart / application/json 皆可）：

```json
{
  "image": "<base64 or file>",
  "floor_id": "F3",
  "virt_map": { "scale": 0.0025, "offset": [120.0, 35.0] },
  "classes": ["lamp","switch","socket"],
  "conf_thresh": 0.35,
  "nms_iou": 0.6
}
```

* **响应**：

```json
{
  "items": [
    {"type":"switch","prob":0.92,"bbox":[x,y,w,h],"virt_bbox":[X,Y,W,H]},
    {"type":"socket","prob":0.88,"bbox":[...]}
  ],
  "counts": {"switch":123,"socket":98,"lamp":176},
  "meta": {"inference_ms":42, "model":"rtdetr_v1.2", "image_size":[2048,2048]}
}
```



# 八、前端实现要点（React+TS）

1. **DWG切块与虚拟尺寸**
	* 流程：DWG→（服务/本地）转PNG → 网格切块（重叠滑窗）→ 记录切块与原图的**仿射映射**
	* 大图分页/懒加载，WebWorker并行切块与编码
2. **调用后端**
	* 批量上传切块（并发控制、失败重试、去重）；可配置阈值
3. **结果可视化**
	* Canvas叠加框、类别/概率、计数统计；导出标注（JSON/PNG）
4. **交互**
	* 类别筛选、阈值滑条、逐块审阅、误报标记与回传“难例”
5. **产出**
	* 导出：整层图的**已标注视图**、**计数报表**（CSV/Excel）


# 九、测试与验收

* **功能测试**：训练脚本稳定、接口正确、前端显示
* **指标验收**（验证集100张）：
	* 漏检率 ≤ 10%（复杂类可单列≤15%）
	* 误检率 ≤ 8%
	* 推理性能：≥ 10 FPS（单GPU/目标分辨率）
* **回归**：每次模型/预处理变更后自动评测并产出对比报告


# 十、风险与应对

* **DWG多源异构/比例不一** → 统一单位与图层、建立映射矩阵；加“比例自检”脚本
* **符号高度相似** → 融合模板匹配/几何先验、难例挖掘、阈值分对象定制
* **数据量不足或偏差** → 增强+合成数据、跨项目复用、主动学习迭代
* **性能瓶颈** → ONNX/TensorRT优化、批推理、CPU并行与GPU混合流水线
* **授权与格式** → 优先自有AutoCAD/ODA工具链，必要时DXF中转


# 十一、交付清单

* 类别字典与示例图库、数据集v1.0、标注规范与审计记录
* 模型权重（识别50个类）、评测报告
* 后端服务（源码+容器镜像）、前端工程（源码+构建产物）
* 使用手册、部署手册、运维手册、API文档

